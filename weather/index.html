<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather App (OpenWeatherMap)</title>
  <meta name="description" content="Simple weather app using OpenWeatherMap current + 5-day/3-hour forecast." />

  <style>
    :root {
      color-scheme: light dark;
      --bg: #0b1020;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.10);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --faint: rgba(255,255,255,0.55);
      --accent: #6bb7ff;
      --bad: #ff6b6b;
      --ok: #59d38b;
      --shadow: 0 18px 60px rgba(0,0,0,0.45);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f4f7ff;
        --panel: rgba(0,0,0,0.05);
        --panel2: rgba(0,0,0,0.07);
        --text: rgba(0,0,0,0.90);
        --muted: rgba(0,0,0,0.68);
        --faint: rgba(0,0,0,0.55);
        --shadow: 0 18px 60px rgba(0,0,0,0.12);
      }
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: var(--sans);
      background:
        radial-gradient(1400px 800px at 10% 10%, rgba(107,183,255,0.18), transparent 55%),
        radial-gradient(1200px 700px at 90% 30%, rgba(89,211,139,0.12), transparent 60%),
        radial-gradient(1200px 700px at 50% 90%, rgba(255,255,255,0.07), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .app {
      width: min(1100px, 100%);
      display: grid;
      gap: 18px;
    }

    header {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .brand {
      display: flex;
      align-items: baseline;
      gap: 10px;
    }

    .brand h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.2px;
    }

    .brand .tag {
      font-family: var(--mono);
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--panel);
      color: var(--muted);
    }

    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .controls input[type="text"] {
      width: min(420px, 70vw);
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: var(--panel);
      color: var(--text);
      outline: none;
    }

    @media (prefers-color-scheme: light) {
      .controls input[type="text"] { border-color: rgba(0,0,0,0.10); }
    }

    .controls button {
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: linear-gradient(180deg, rgba(107,183,255,0.25), rgba(107,183,255,0.12));
      color: var(--text);
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    @media (prefers-color-scheme: light) {
      .controls button {
        border-color: rgba(0,0,0,0.10);
        box-shadow: 0 10px 30px rgba(0,0,0,0.06);
      }
    }

    .controls button.secondary {
      background: var(--panel);
      box-shadow: none;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 18px;
    }

    @media (max-width: 960px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    @media (prefers-color-scheme: light) {
      .card { border-color: rgba(0,0,0,0.10); }
    }

    .card .hd {
      padding: 16px 16px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
    }

    @media (prefers-color-scheme: light) {
      .card .hd { border-bottom-color: rgba(0,0,0,0.08); }
    }

    .card .hd h2 {
      margin: 0;
      font-size: 14px;
      letter-spacing: 0.18px;
      color: var(--muted);
      text-transform: uppercase;
    }

    .card .bd { padding: 16px; }

    .now {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 16px;
      align-items: center;
    }

    @media (max-width: 560px) {
      .now { grid-template-columns: 1fr; }
    }

    .place {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .place .where {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .place .where .city {
      font-size: 22px;
      font-weight: 650;
      letter-spacing: 0.2px;
    }

    .place .where .meta {
      font-family: var(--mono);
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--panel2);
      color: var(--muted);
    }

    .temp {
      display: flex;
      align-items: baseline;
      gap: 10px;
      flex-wrap: wrap;
    }

    .temp .big {
      font-size: 56px;
      font-weight: 750;
      letter-spacing: -1px;
      line-height: 1;
    }

    .temp .desc {
      color: var(--muted);
      font-size: 14px;
      max-width: 34ch;
    }

    .kpis {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    @media (max-width: 560px) {
      .kpis { grid-template-columns: 1fr; }
    }

    .kpi {
      padding: 12px;
      border-radius: 14px;
      background: var(--panel2);
      border: 1px solid rgba(255,255,255,0.08);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    @media (prefers-color-scheme: light) {
      .kpi { border-color: rgba(0,0,0,0.08); }
    }

    .kpi .label {
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.14px;
    }

    .kpi .value {
      font-family: var(--mono);
      font-size: 14px;
    }

    .icon {
      width: 96px;
      height: 96px;
      border-radius: 22px;
      background: rgba(107,183,255,0.14);
      display: grid;
      place-items: center;
      border: 1px solid rgba(255,255,255,0.10);
    }

    @media (prefers-color-scheme: light) {
      .icon { border-color: rgba(0,0,0,0.10); }
    }

    .icon img {
      width: 76px;
      height: 76px;
      image-rendering: -webkit-optimize-contrast;
    }

    .forecast {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 960px) {
      .forecast { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    @media (max-width: 560px) {
      .forecast { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    .slot {
      padding: 12px;
      border-radius: 14px;
      background: var(--panel2);
      border: 1px solid rgba(255,255,255,0.08);
      display: grid;
      gap: 8px;
    }

    @media (prefers-color-scheme: light) {
      .slot { border-color: rgba(0,0,0,0.08); }
    }

    .slot .when {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
    }

    .slot .line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .slot .t {
      font-family: var(--mono);
      font-size: 14px;
    }

    .slot img { width: 34px; height: 34px; }

    .small {
      font-size: 12px;
      color: var(--faint);
      line-height: 1.45;
    }

    .status {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--faint);
    }

    .dot.ok { background: var(--ok); }
    .dot.bad { background: var(--bad); }

    details {
      border-top: 1px solid rgba(255,255,255,0.10);
      padding: 12px 16px 16px;
    }

    @media (prefers-color-scheme: light) {
      details { border-top-color: rgba(0,0,0,0.08); }
    }

    summary {
      cursor: pointer;
      color: var(--muted);
      user-select: none;
    }

    .config {
      display: grid;
      gap: 12px;
      margin-top: 12px;
    }

    .config label {
      font-size: 12px;
      color: var(--muted);
      display: grid;
      gap: 6px;
    }

    .config input {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: var(--panel);
      color: var(--text);
      outline: none;
      font-family: var(--mono);
      font-size: 12px;
    }

    @media (prefers-color-scheme: light) {
      .config input { border-color: rgba(0,0,0,0.10); }
    }

    .toast {
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      width: min(720px, calc(100% - 32px));
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(0,0,0,0.65);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.92);
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
      display: none;
      gap: 10px;
      align-items: flex-start;
    }

    @media (prefers-color-scheme: light) {
      .toast {
        background: rgba(255,255,255,0.78);
        color: rgba(0,0,0,0.88);
        border-color: rgba(0,0,0,0.10);
      }
    }

    .toast.show { display: flex; }
    .toast .t-title { font-weight: 650; }
    .toast .t-body { color: inherit; opacity: 0.9; }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="brand">
        <h1>Weather</h1>
        <span class="tag">OpenWeatherMap</span>
      </div>

      <div class="controls">
        <input id="q" type="text" placeholder="Search city (e.g., Orlando, FL)" autocomplete="off" />
        <button id="btnSearch" type="button">Search</button>
        <button id="btnHere" class="secondary" type="button">Use my location</button>
      </div>
    </header>

    <section class="grid">
      <article class="card" aria-live="polite">
        <div class="hd">
          <h2>Now</h2>
          <div class="status" id="status">
            <span class="dot" id="statusDot" aria-hidden="true"></span>
            <span id="statusText">Idle</span>
          </div>
        </div>

        <div class="bd">
          <div class="now">
            <div class="place">
              <div class="where">
                <div class="city" id="city">Search a city or use your location</div>
                <div class="meta" id="meta">units: ¬∞F / mph</div>
              </div>

              <div class="temp">
                <div class="big" id="temp">--¬∞</div>
                <div class="desc" id="desc">Waiting for weather data‚Ä¶</div>
              </div>

              <div class="kpis">
                <div class="kpi">
                  <div class="label">Feels like</div>
                  <div class="value" id="feels">--</div>
                </div>
                <div class="kpi">
                  <div class="label">Humidity</div>
                  <div class="value" id="humidity">--</div>
                </div>
                <div class="kpi">
                  <div class="label">Wind</div>
                  <div class="value" id="wind">--</div>
                </div>
                <div class="kpi">
                  <div class="label">Pressure</div>
                  <div class="value" id="pressure">--</div>
                </div>
              </div>

              <p class="small" id="updated">Last updated: --</p>
            </div>

            <div class="icon" title="Weather icon">
              <img id="icon" alt="" src="" hidden />
            </div>
          </div>
        </div>

        <details>
          <summary>Config</summary>
          <div class="config">
            <label>
              OpenWeatherMap API key
              <input id="apiKey" type="password" placeholder="Paste your API key here" />
            </label>

            <label>
              Units
              <input id="units" type="text" value="imperial" aria-describedby="unitsHelp" />
              <div class="small" id="unitsHelp">Use <span style="font-family: var(--mono)">imperial</span> (¬∞F), <span style="font-family: var(--mono)">metric</span> (¬∞C), or <span style="font-family: var(--mono)">standard</span> (K).</div>
            </label>

            <div class="small">Tip: Your key is saved locally in your browser (localStorage). Don‚Äôt paste secrets into code you deploy publicly. üåßÔ∏èüîê</div>
          </div>
        </details>
      </article>

      <aside class="card">
        <div class="hd">
          <h2>Next 24 hours (3-hour steps)</h2>
          <div class="small" id="tz">Timezone: --</div>
        </div>

        <div class="bd">
          <div class="forecast" id="forecast">
            <!-- forecast slots injected here -->
          </div>
          <p class="small" style="margin-top: 12px;">Source: OpenWeatherMap 5 day / 3 hour forecast. This panel shows the next 8 timestamps (about 24 hours).</p>
        </div>
      </aside>
    </section>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <div>‚ö†Ô∏è</div>
    <div>
      <div class="t-title" id="toastTitle">Notice</div>
      <div class="t-body" id="toastBody">‚Ä¶</div>
    </div>
  </div>

  <script>
    // Weather App (OpenWeatherMap)
    // - Uses 2 endpoints: /weather (current) + /forecast (5 day / 3 hour)
    // - Search by city query or use Geolocation (lat/lon)
    // - Stores apiKey + units in localStorage

    const els = {
      q: document.querySelector('#q'),
      btnSearch: document.querySelector('#btnSearch'),
      btnHere: document.querySelector('#btnHere'),
      apiKey: document.querySelector('#apiKey'),
      units: document.querySelector('#units'),

      statusDot: document.querySelector('#statusDot'),
      statusText: document.querySelector('#statusText'),

      city: document.querySelector('#city'),
      meta: document.querySelector('#meta'),
      temp: document.querySelector('#temp'),
      desc: document.querySelector('#desc'),
      feels: document.querySelector('#feels'),
      humidity: document.querySelector('#humidity'),
      wind: document.querySelector('#wind'),
      pressure: document.querySelector('#pressure'),
      updated: document.querySelector('#updated'),
      icon: document.querySelector('#icon'),

      tz: document.querySelector('#tz'),
      forecast: document.querySelector('#forecast'),

      toast: document.querySelector('#toast'),
      toastTitle: document.querySelector('#toastTitle'),
      toastBody: document.querySelector('#toastBody'),
    };

    const LS = {
      apiKey: 'owm_api_key',
      units: 'owm_units',
      lastQuery: 'owm_last_query'
    };

    const OWM = {
      base: 'https://api.openweathermap.org/data/2.5',
      icon: (code) => `https://openweathermap.org/img/wn/${code}@2x.png`,
    };

    init();

    function init() {
      // Restore settings
      const savedKey = localStorage.getItem(LS.apiKey);
      const savedUnits = localStorage.getItem(LS.units);
      const savedQuery = localStorage.getItem(LS.lastQuery);

      if (savedKey) els.apiKey.value = savedKey;
      if (savedUnits) els.units.value = savedUnits;
      if (savedQuery) els.q.value = savedQuery;

      updateUnitsMeta();
      setStatus('Idle', 'neutral');

      // Events
      els.btnSearch.addEventListener('click', onSearch);
      els.btnHere.addEventListener('click', onUseMyLocation);
      els.q.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') onSearch();
      });

      els.apiKey.addEventListener('input', () => {
        localStorage.setItem(LS.apiKey, els.apiKey.value.trim());
      });

      els.units.addEventListener('input', () => {
        localStorage.setItem(LS.units, els.units.value.trim());
        updateUnitsMeta();
      });

      // Optional: auto-load last query on refresh (if key exists)
      if (savedKey && savedQuery) {
        onSearch(true);
      }
    }

    function updateUnitsMeta() {
      const u = (els.units.value || 'imperial').trim();
      const label = u === 'metric' ? '¬∞C / m/s' : (u === 'standard' ? 'K / m/s' : '¬∞F / mph');
      els.meta.textContent = `units: ${label}`;
    }

    function setStatus(text, state) {
      // state: 'neutral' | 'ok' | 'bad'
      els.statusText.textContent = text;
      els.statusDot.className = 'dot' + (state === 'ok' ? ' ok' : state === 'bad' ? ' bad' : '');
    }

    function toast(title, body) {
      els.toastTitle.textContent = title;
      els.toastBody.textContent = body;
      els.toast.classList.add('show');
      window.clearTimeout(toast._t);
      toast._t = window.setTimeout(() => els.toast.classList.remove('show'), 4500);
    }

    function getKey() {
      const key = (els.apiKey.value || '').trim();
      if (!key) {
        toast('Missing API key', 'Paste your OpenWeatherMap API key in Config.');
        throw new Error('Missing API key');
      }
      return key;
    }

    function getUnits() {
      const u = (els.units.value || 'imperial').trim();
      return u || 'imperial';
    }

    async function onSearch(silent = false) {
      const q = (els.q.value || '').trim();
      if (!q) {
        if (!silent) toast('Type a city', 'Example: ‚ÄúOrlando, FL‚Äù or ‚ÄúLondon‚Äù.');
        return;
      }

      localStorage.setItem(LS.lastQuery, q);

      try {
        setStatus('Loading‚Ä¶', 'neutral');
        const key = getKey();
        const units = getUnits();

        // Current
        const current = await owmFetch('/weather', { q, appid: key, units });
        renderCurrent(current, units);

        // Forecast (same city query)
        const fc = await owmFetch('/forecast', { q, appid: key, units });
        renderForecast(fc, units);

        setStatus('Live', 'ok');
      } catch (err) {
        console.error(err);
        setStatus('Error', 'bad');
        toast('Could not load weather', humanizeError(err));
      }
    }

    async function onUseMyLocation() {
      if (!('geolocation' in navigator)) {
        toast('Geolocation not available', 'Your browser/device does not support geolocation.');
        return;
      }

      try {
        setStatus('Locating‚Ä¶', 'neutral');
        const pos = await getPosition({ enableHighAccuracy: true, timeout: 12000, maximumAge: 60_000 });
        const { latitude: lat, longitude: lon } = pos.coords;

        setStatus('Loading‚Ä¶', 'neutral');
        const key = getKey();
        const units = getUnits();

        // Current
        const current = await owmFetch('/weather', { lat, lon, appid: key, units });
        renderCurrent(current, units);

        // Forecast
        const fc = await owmFetch('/forecast', { lat, lon, appid: key, units });
        renderForecast(fc, units);

        // Put a friendly label into the search box for later
        if (current?.name) {
          els.q.value = current.sys?.country ? `${current.name}, ${current.sys.country}` : current.name;
          localStorage.setItem(LS.lastQuery, els.q.value);
        }

        setStatus('Live', 'ok');
      } catch (err) {
        console.error(err);
        setStatus('Error', 'bad');
        toast('Location failed', humanizeError(err));
      }
    }

    function getPosition(options) {
      return new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject, options);
      });
    }

    async function owmFetch(path, params) {
      const url = new URL(OWM.base + path);
      Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, String(v)));

      const res = await fetch(url.toString());
      let data;
      try { data = await res.json(); } catch { data = null; }

      if (!res.ok) {
        const msg = data?.message ? String(data.message) : `HTTP ${res.status}`;
        const err = new Error(msg);
        err.status = res.status;
        err.data = data;
        throw err;
      }

      return data;
    }

    function renderCurrent(data, units) {
      // Defensive: OpenWeatherMap can omit some fields based on errors
      const name = data?.name ?? 'Unknown';
      const country = data?.sys?.country ?? '';
      const dt = data?.dt ? new Date(data.dt * 1000) : new Date();

      const w = Array.isArray(data?.weather) ? data.weather[0] : null;
      const main = data?.main ?? {};
      const wind = data?.wind ?? {};

      els.city.textContent = country ? `${name}, ${country}` : name;
      els.desc.textContent = w?.description ? capitalize(w.description) : '‚Äî';

      const t = main?.temp;
      els.temp.textContent = Number.isFinite(t) ? `${Math.round(t)}¬∞` : '--¬∞';

      const feels = main?.feels_like;
      els.feels.textContent = Number.isFinite(feels) ? fmtTemp(feels, units) : '‚Äî';

      const hum = main?.humidity;
      els.humidity.textContent = Number.isFinite(hum) ? `${Math.round(hum)}%` : '‚Äî';

      const pres = main?.pressure;
      els.pressure.textContent = Number.isFinite(pres) ? `${Math.round(pres)} hPa` : '‚Äî';

      const wSpeed = wind?.speed;
      els.wind.textContent = Number.isFinite(wSpeed) ? fmtWind(wSpeed, units) : '‚Äî';

      els.updated.textContent = `Last updated: ${dt.toLocaleString()}`;

      // icon
      const iconCode = w?.icon;
      if (iconCode) {
        els.icon.src = OWM.icon(iconCode);
        els.icon.hidden = false;
        els.icon.alt = w?.main ? `Icon: ${w.main}` : 'Weather icon';
      } else {
        els.icon.hidden = true;
        els.icon.alt = '';
      }

      // timezone info
      const tzSeconds = Number.isFinite(data?.timezone) ? data.timezone : null;
      if (tzSeconds !== null) {
        const hours = tzSeconds / 3600;
        els.tz.textContent = `Timezone offset: UTC${hours >= 0 ? '+' : ''}${hours}`;
      } else {
        els.tz.textContent = 'Timezone: --';
      }
    }

    function renderForecast(data, units) {
      // OpenWeatherMap /forecast gives list[] of 3-hour steps
      const list = Array.isArray(data?.list) ? data.list : [];
      const first8 = list.slice(0, 8);

      els.forecast.innerHTML = '';

      if (!first8.length) {
        els.forecast.innerHTML = `<div class="small">No forecast data.</div>`;
        return;
      }

      for (const item of first8) {
        const dt = item?.dt ? new Date(item.dt * 1000) : null;
        const when = dt ? dt.toLocaleString(undefined, { weekday: 'short', hour: 'numeric', minute: '2-digit' }) : '‚Äî';

        const w = Array.isArray(item?.weather) ? item.weather[0] : null;
        const icon = w?.icon;

        const t = item?.main?.temp;
        const tTxt = Number.isFinite(t) ? fmtTemp(t, units) : '‚Äî';

        const pop = Number.isFinite(item?.pop) ? `${Math.round(item.pop * 100)}%` : '‚Äî';

        const el = document.createElement('div');
        el.className = 'slot';
        el.innerHTML = `
          <div class="when">${escapeHtml(when)}</div>
          <div class="line">
            <div class="t">${escapeHtml(tTxt)}</div>
            ${icon ? `<img alt="" src="${OWM.icon(icon)}" />` : ``}
          </div>
          <div class="small">${escapeHtml(w?.description ? capitalize(w.description) : '‚Äî')}</div>
          <div class="small">Rain chance: <span style="font-family: var(--mono)">${escapeHtml(pop)}</span></div>
        `;

        els.forecast.appendChild(el);
      }
    }

    function fmtTemp(value, units) {
      const v = Math.round(value);
      if (units === 'metric') return `${v}¬∞C`;
      if (units === 'standard') return `${v}K`;
      return `${v}¬∞F`;
    }

    function fmtWind(value, units) {
      // OpenWeatherMap returns m/s for metric & standard; mph for imperial
      const v = Math.round(value);
      if (units === 'imperial') return `${v} mph`;
      return `${v} m/s`;
    }

    function capitalize(s) {
      return String(s).split(' ').map(w => w ? (w[0].toUpperCase() + w.slice(1)) : '').join(' ');
    }

    function humanizeError(err) {
      if (!err) return 'Unknown error';
      const msg = String(err.message || err);

      // Common OWM responses: "city not found", "Invalid API key", etc.
      if (msg.toLowerCase().includes('invalid api key')) {
        return 'Your API key looks invalid. Double-check it in OpenWeatherMap and try again.';
      }
      if (msg.toLowerCase().includes('city not found')) {
        return 'City not found. Try a different spelling or add a country/state.';
      }
      if (err.status === 401) {
        return 'Unauthorized (401). Check your API key.';
      }
      if (err.status === 429) {
        return 'Rate limited (429). You hit the API too fast. Try again in a minute.';
      }
      return msg;
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }
  </script>
</body>
</html>
