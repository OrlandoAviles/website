<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Card Combat RPG</title>
<style>
  body { font-family: 'Poppins', sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0; background:linear-gradient(180deg, #111, #222); color:#eee; overflow:hidden; }
  #game { display:flex; flex-direction:column; align-items:center; width:100%; max-width:600px; }

  /* Battlefield layout */
  .field { display:flex; justify-content:space-around; width:100%; margin:10px 0; }
  .card { background:#333; border-radius:12px; padding:10px; width:90px; text-align:center; box-shadow:0 0 10px rgba(0,0,0,0.5); transition:transform 0.2s ease; }
  .card.alive:hover { transform:scale(1.05); cursor:pointer; }
  .enemy.card { background:linear-gradient(180deg, #500, #800); }
  .player.card { background:linear-gradient(180deg, #024, #036); }
  .dead { opacity:0.3; filter:grayscale(0.8); }
  .turn { outline:3px solid gold; }

  /* HP bar */
  .hp-bar { width:100%; height:8px; background:#111; border-radius:4px; overflow:hidden; margin-top:5px; }
  .hp-fill { height:100%; background:#0f0; width:100%; transition:width 0.3s ease; }

  #actions { margin-top:10px; display:flex; gap:10px; }
  button { padding:10px 20px; border:none; border-radius:8px; background:#555; color:#eee; font-size:16px; }
  button:hover { background:#777; cursor:pointer; }

  #battle-log { margin-top:10px; height:120px; overflow-y:auto; width:90%; background:#222; padding:10px; border-radius:10px; }
  canvas { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
</style>
</head>
<body>
<canvas id="fx"></canvas>
<div id="game">
  <h1>Card Combat RPG</h1>
  <div class="field" id="enemy-field"></div>
  <div class="field" id="player-field"></div>
  <div id="actions"></div>
  <div id="battle-log"></div>
</div>
<script>
let players = [
  {name:'Player 1', hp:100, maxHp:100, speed:10, team:'player'},
  {name:'Player 2', hp:100, maxHp:100, speed:12, team:'player'},
  {name:'Player 3', hp:100, maxHp:100, speed:8, team:'player'}
];
let enemies = [
  {name:'Enemy 1', hp:100, maxHp:100, speed:9, team:'enemy'},
  {name:'Enemy 2', hp:100, maxHp:100, speed:11, team:'enemy'},
  {name:'Enemy 3', hp:100, maxHp:100, speed:7, team:'enemy'}
];
let allUnits = [...players, ...enemies];
let turnQueue = [];
let currentUnit = null;

function log(text) {
  const logDiv = document.getElementById('battle-log');
  logDiv.innerHTML += text + '<br>';
  logDiv.scrollTop = logDiv.scrollHeight;
}

function updateStatus() {
  const playerField = document.getElementById('player-field');
  const enemyField = document.getElementById('enemy-field');
  playerField.innerHTML = '';
  enemyField.innerHTML = '';

  players.forEach(p => playerField.appendChild(makeCard(p)));
  enemies.forEach(e => enemyField.appendChild(makeCard(e)));
}

function makeCard(unit) {
  const card = document.createElement('div');
  card.className = `${unit.team} card ${unit.hp<=0?'dead':'alive'} ${currentUnit===unit?'turn':''}`;
  card.innerHTML = `<strong>${unit.name}</strong><div class='hp-bar'><div class='hp-fill' style='width:${(unit.hp/unit.maxHp)*100}%; background:${unit.team==='player'?'#0f0':'#f00'}'></div></div>`;
  if(currentUnit && currentUnit.team==='player' && unit.team==='enemy' && unit.hp>0) {
    card.onclick = () => playerAttack(unit);
  }
  return card;
}

function setupQueue() {
  turnQueue = [...allUnits].sort((a,b) => b.speed - a.speed);
}

function nextTurn() {
  if(checkGameOver()) return;
  currentUnit = turnQueue.shift();
  if(currentUnit.hp <= 0) { nextTurn(); return; }
  turnQueue.push(currentUnit);
  updateStatus();
  if(currentUnit.team==='player') {
    showPlayerActions();
  } else {
    enemyAction();
  }
}

function showPlayerActions() {
  const actionsDiv = document.getElementById('actions');
  actionsDiv.innerHTML = '';
  ['Attack','Heal'].forEach(act => {
    const btn = document.createElement('button');
    btn.innerText = act;
    btn.onclick = () => act==='Attack'? log('Choose an enemy target!'): playerHeal();
    actionsDiv.appendChild(btn);
  });
}

function playerAttack(target) {
  const damage = Math.floor(Math.random()*20)+5;
  target.hp -= damage;
  if(target.hp<0) target.hp=0;
  log(`${currentUnit.name} attacks ${target.name} for ${damage} damage!`);
  playSlashFX();
  endTurn();
}

function playerHeal() {
  const healAmount = Math.floor(Math.random()*15)+10;
  currentUnit.hp = Math.min(currentUnit.maxHp, currentUnit.hp+healAmount);
  log(`${currentUnit.name} heals for ${healAmount} HP!`);
  playHealFX();
  endTurn();
}

function enemyAction() {
  const target = players.filter(p=>p.hp>0)[Math.floor(Math.random()*players.filter(p=>p.hp>0).length)];
  const damage = Math.floor(Math.random()*20)+5;
  target.hp -= damage;
  if(target.hp<0) target.hp=0;
  log(`${currentUnit.name} attacks ${target.name} for ${damage} damage!`);
  playSlashFX();
  endTurn();
}

function endTurn() {
  document.getElementById('actions').innerHTML = '';
  updateStatus();
  setTimeout(nextTurn,700);
}

function checkGameOver() {
  if(players.every(p=>p.hp<=0)) { log('ðŸ’€ All players defeated!'); return true; }
  if(enemies.every(e=>e.hp<=0)) { log('ðŸŽ‰ All enemies defeated!'); return true; }
  return false;
}

// --- FX Canvas Layer ---
const canvas = document.getElementById('fx');
const ctx = canvas.getContext('2d');
resizeCanvas();
window.addEventListener('resize', resizeCanvas);
function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }

function playSlashFX(){ drawFX('#f00'); }
function playHealFX(){ drawFX('#0f0'); }

function drawFX(color){
  let alpha=1;
  function anim(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.globalAlpha=alpha;
    ctx.strokeStyle=color;
    ctx.lineWidth=5;
    ctx.beginPath();
    ctx.moveTo(Math.random()*canvas.width, Math.random()*canvas.height);
    ctx.lineTo(Math.random()*canvas.width, Math.random()*canvas.height);
    ctx.stroke();
    ctx.globalAlpha=1;
    alpha-=0.1;
    if(alpha>0) requestAnimationFrame(anim);
  }
  anim();
}

updateStatus();
setupQueue();
log('Battle Start!');
nextTurn();
</script>
</body>
</html>
