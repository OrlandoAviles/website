<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Particle Engine (v0.1)</title>
  <style>
    :root {
      --bg: #0f0f12;
      --panel: #18181d;
      --panel2: #1f1f26;
      --text: #eaeaea;
      --muted: #a3a3a3;
      --accent: #4cafef;
      --good: #4cefa1;
      --warn: #ffc107;
      --danger: #ff3b6b;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
      min-height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr;
    }

    header {
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(135deg, rgba(76,175,239,0.13), rgba(76,239,161,0.05));
    }

    .title-row {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    h1 {
      margin: 0;
      font-size: 1.2rem;
      letter-spacing: 0.2px;
    }

    .subtitle {
      margin-top: 6px;
      color: var(--muted);
      font-size: 0.95rem;
      line-height: 1.35;
      max-width: 900px;
    }

    .badge {
      display: inline-block;
      font-size: 0.75rem;
      padding: 5px 9px;
      border-radius: 999px;
      margin-left: 10px;
      vertical-align: middle;
      background: rgba(255,255,255,0.08);
      color: #ddd;
      border: 1px solid rgba(255,255,255,0.12);
      user-select: none;
    }

    .badge.v {
      background: rgba(76, 175, 239, 0.12);
      border-color: rgba(76, 175, 239, 0.22);
      color: #8fd2ff;
    }

    main {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 12px;
      padding: 12px;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 12px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.35);
    }

    .panel h2 {
      margin: 0 0 10px;
      font-size: 1rem;
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .btn {
      appearance: none;
      border: 1px solid rgba(255,255,255,0.12);
      background: var(--panel2);
      color: var(--text);
      border-radius: 12px;
      padding: 11px 12px;
      text-align: left;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.06s, border-color 0.2s, background 0.2s;
      touch-action: manipulation;
    }

    .btn:hover {
      border-color: rgba(76,175,239,0.35);
      background: rgba(76,175,239,0.10);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn small {
      display: block;
      margin-top: 5px;
      color: var(--muted);
      font-weight: normal;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .label {
      font-size: 0.85rem;
      color: var(--muted);
      margin: 6px 0 6px;
    }

    input[type="range"] {
      width: 100%;
    }

    .hud {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.08);
    }

    canvas {
      width: 100%;
      height: 100%;
      border-radius: 14px;
      display: block;
      background: radial-gradient(circle at 50% 40%, rgba(255,255,255,0.06), rgba(0,0,0,0.45));
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.20);
      touch-action: none;
    }

    .hint {
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: 10px;
      line-height: 1.4;
    }

    .kbd {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 7px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.25);
      color: #ddd;
      font-size: 0.82rem;
      margin: 0 2px;
    }

    .tiny {
      font-size: 0.85rem;
      color: var(--muted);
    }

    a {
      color: #8fd2ff;
      text-decoration: none;
    }

    a:hover { text-decoration: underline; }
  </style>
</head>
<body>

<header>
  <div class="title-row">
    <h1>Particle Engine <span class="badge v">v0.1</span></h1>
    <div class="tiny">Creative Dojo Tool ¬∑ Local-first ¬∑ Vanilla JS</div>
  </div>
  <div class="subtitle">
    Tap/click to spawn particles. Switch presets below (Hit Sparks, Heal Glow, UI Shimmer). This tool is designed to be reusable in the Top-Down RPG and ATB Combat modules.
  </div>
</header>

<main>
  <section class="panel">
    <h2>Presets</h2>

    <div class="controls">
      <button class="btn" id="presetHit">‚ö° Hit Sparks <small>Sharp burst with gravity + fade</small></button>
      <button class="btn" id="presetHeal">‚ú® Heal Glow <small>Soft upward glow particles</small></button>
      <button class="btn" id="presetShimmer">üåü UI Shimmer <small>Gentle sparkles, low gravity</small></button>

      <div class="row">
        <button class="btn" id="presetSmoke">üå´Ô∏è Smoke <small>Slow drift, bigger particles</small></button>
        <button class="btn" id="presetConfetti">üéâ Confetti <small>Colorful burst, playful</small></button>
      </div>

      <div class="label">Emitter Strength</div>
      <input type="range" id="strength" min="10" max="200" value="60" />

      <div class="label">Gravity</div>
      <input type="range" id="gravity" min="-200" max="800" value="240" />

      <div class="row">
        <button class="btn" id="clear">üßΩ Clear <small>Remove all particles</small></button>
        <button class="btn" id="pause">‚è∏Ô∏è Pause <small>Toggle simulation</small></button>
      </div>
    </div>

    <div class="hud">
      <div>Preset: <strong id="presetName">Hit Sparks</strong></div>
      <div>Particles: <strong id="count">0</strong></div>
    </div>

    <div class="hint">
      <div><span class="kbd">Click/Tap</span> spawn particles</div>
      <div><span class="kbd">Space</span> pause ¬∑ <span class="kbd">C</span> clear ¬∑ <span class="kbd">1-5</span> presets</div>
      <div class="tiny" style="margin-top:8px;">Tip: this engine is written so it can be copy/pasted into your RPG and called like: <code>emit("hit", x, y)</code>.</div>
    </div>
  </section>

  <section>
    <canvas id="canvas"></canvas>
  </section>
</main>

<script>
  // Particle Engine v0.1 (Vanilla JS)
  // Creative Dojo Tool: reusable 2D particles for game feel and UI polish.

  const VERSION = "0.1";

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const ui = {
    presetName: document.getElementById("presetName"),
    count: document.getElementById("count"),
    strength: document.getElementById("strength"),
    gravity: document.getElementById("gravity"),
    clear: document.getElementById("clear"),
    pause: document.getElementById("pause"),
  };

  function resizeCanvas() {
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * dpr);
    canvas.height = Math.floor(rect.height * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }

  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  // ------------------------------------------------------------
  // Core particle structure
  // ------------------------------------------------------------

  const particles = [];

  function rand(min, max) {
    return Math.random() * (max - min) + min;
  }

  function clamp(v, a, b) {
    return Math.max(a, Math.min(b, v));
  }

  function_toggle = false;

  const engine = {
    paused: false,
    gravity: 240,
    preset: "hit",
    strength: 60,
  };

  function addParticle(p) {
    particles.push(p);
  }

  function emitBurst(x, y, presetKey, strength) {
    const preset = PRESETS[presetKey];
    const n = Math.floor(clamp(strength, 1, 400) * preset.mult);

    for (let i = 0; i < n; i++) {
      const angle = rand(preset.spreadA, preset.spreadB);
      const speed = rand(preset.speedMin, preset.speedMax);

      addParticle({
        x,
        y,
        vx: Math.cos(angle) * speed + rand(-preset.jitter, preset.jitter),
        vy: Math.sin(angle) * speed + rand(-preset.jitter, preset.jitter),

        size: rand(preset.sizeMin, preset.sizeMax),
        sizeDecay: rand(preset.sizeDecayMin, preset.sizeDecayMax),

        life: rand(preset.lifeMin, preset.lifeMax),
        age: 0,

        drag: rand(preset.dragMin, preset.dragMax),
        gravityScale: preset.gravityScale,

        color: preset.colorFn(),
        alpha: 1,
        fade: preset.fade,
      });
    }
  }

  // ------------------------------------------------------------
  // Presets
  // ------------------------------------------------------------

  const PRESETS = {
    hit: {
      name: "Hit Sparks",
      mult: 0.8,
      spreadA: 0,
      spreadB: Math.PI * 2,
      speedMin: 140,
      speedMax: 520,
      sizeMin: 2,
      sizeMax: 5,
      sizeDecayMin: 7,
      sizeDecayMax: 14,
      lifeMin: 0.25,
      lifeMax: 0.6,
      dragMin: 1.0,
      dragMax: 3.0,
      gravityScale: 1.0,
      jitter: 25,
      fade: 1.1,
      colorFn: () => {
        // warm spark palette
        const r = Math.floor(rand(220, 255));
        const g = Math.floor(rand(150, 240));
        const b = Math.floor(rand(40, 110));
        return `rgb(${r},${g},${b})`;
      },
    },

    heal: {
      name: "Heal Glow",
      mult: 0.5,
      spreadA: -Math.PI * 0.75,
      spreadB: -Math.PI * 0.25,
      speedMin: 40,
      speedMax: 170,
      sizeMin: 4,
      sizeMax: 10,
      sizeDecayMin: 3,
      sizeDecayMax: 6,
      lifeMin: 0.6,
      lifeMax: 1.2,
      dragMin: 0.2,
      dragMax: 1.3,
      gravityScale: -0.15,
      jitter: 10,
      fade: 0.8,
      colorFn: () => {
        const r = Math.floor(rand(80, 170));
        const g = Math.floor(rand(230, 255));
        const b = Math.floor(rand(150, 230));
        return `rgb(${r},${g},${b})`;
      },
    },

    shimmer: {
      name: "UI Shimmer",
      mult: 0.45,
      spreadA: 0,
      spreadB: Math.PI * 2,
      speedMin: 10,
      speedMax: 85,
      sizeMin: 1,
      sizeMax: 3,
      sizeDecayMin: 1,
      sizeDecayMax: 4,
      lifeMin: 0.7,
      lifeMax: 1.6,
      dragMin: 0.2,
      dragMax: 1.0,
      gravityScale: 0.05,
      jitter: 6,
      fade: 0.55,
      colorFn: () => {
        const v = Math.floor(rand(210, 255));
        return `rgb(${v},${v},${v})`;
      },
    },

    smoke: {
      name: "Smoke",
      mult: 0.30,
      spreadA: -Math.PI,
      spreadB: 0,
      speedMin: 10,
      speedMax: 70,
      sizeMin: 10,
      sizeMax: 24,
      sizeDecayMin: 0.5,
      sizeDecayMax: 2.2,
      lifeMin: 1.2,
      lifeMax: 2.6,
      dragMin: 0.0,
      dragMax: 0.9,
      gravityScale: -0.08,
      jitter: 5,
      fade: 0.35,
      colorFn: () => {
        const v = Math.floor(rand(70, 150));
        return `rgb(${v},${v},${v})`;
      },
    },

    confetti: {
      name: "Confetti",
      mult: 0.85,
      spreadA: 0,
      spreadB: Math.PI * 2,
      speedMin: 150,
      speedMax: 540,
      sizeMin: 2,
      sizeMax: 6,
      sizeDecayMin: 2,
      sizeDecayMax: 8,
      lifeMin: 0.45,
      lifeMax: 1.15,
      dragMin: 0.8,
      dragMax: 2.4,
      gravityScale: 0.9,
      jitter: 45,
      fade: 0.7,
      colorFn: () => {
        const colors = [
          "#ff3b6b",
          "#4cafef",
          "#4cefa1",
          "#ffc107",
          "#e2a8ff",
          "#ffffff",
        ];
        return colors[Math.floor(Math.random() * colors.length)];
      },
    },
  };

  function setPreset(key) {
    engine.preset = key;
    ui.presetName.textContent = PRESETS[key].name;
  }

  // ------------------------------------------------------------
  // Simulation loop
  // ------------------------------------------------------------

  let last = performance.now();

  function step(now) {
    const dt = Math.min(0.033, (now - last) / 1000);
    last = now;

    if (!engine.paused) {
      simulate(dt);
    }

    render();
    requestAnimationFrame(step);
  }

  function simulate(dt) {
    engine.gravity = Number(ui.gravity.value);
    engine.strength = Number(ui.strength.value);

    for (let i = particles.length - 1; i >= 0; i--) {
      const p = particles[i];

      p.age += dt;
      if (p.age >= p.life) {
        particles.splice(i, 1);
        continue;
      }

      // physics
      const g = engine.gravity * p.gravityScale;
      p.vy += g * dt;

      // drag
      p.vx -= p.vx * p.drag * dt;
      p.vy -= p.vy * p.drag * dt;

      p.x += p.vx * dt;
      p.y += p.vy * dt;

      // size + fade
      p.size = Math.max(0, p.size - p.sizeDecay * dt);
      const t = p.age / p.life;
      p.alpha = Math.max(0, 1 - t * p.fade);
    }

    ui.count.textContent = String(particles.length);
  }

  function render() {
    const w = canvas.clientWidth;
    const h = canvas.clientHeight;

    ctx.clearRect(0, 0, w, h);

    // subtle vignette
    ctx.save();
    ctx.globalAlpha = 0.5;
    ctx.fillStyle = "rgba(0,0,0,0.25)";
    ctx.fillRect(0, 0, w, h);
    ctx.restore();

    for (const p of particles) {
      if (p.alpha <= 0 || p.size <= 0) continue;

      ctx.save();
      ctx.globalAlpha = p.alpha;
      ctx.fillStyle = p.color;

      // circles for now (we can add shapes later)
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    // overlay crosshair at last pointer, optional
    if (pointer.active) {
      ctx.save();
      ctx.globalAlpha = 0.45;
      ctx.strokeStyle = "rgba(255,255,255,0.25)";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.arc(pointer.x, pointer.y, 10, 0, Math.PI * 2);
      ctx.stroke();
      ctx.restore();
    }
  }

  // ------------------------------------------------------------
  // Input
  // ------------------------------------------------------------

  const pointer = {
    x: 0,
    y: 0,
    active: false,
  };

  function getCanvasPos(e) {
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left);
    const y = (e.clientY - rect.top);
    return { x, y };
  }

  function spawnAt(x, y) {
    emitBurst(x, y, engine.preset, engine.strength);
  }

  canvas.addEventListener("pointerdown", (e) => {
    canvas.setPointerCapture(e.pointerId);
    pointer.active = true;
    const pos = getCanvasPos(e);
    pointer.x = pos.x;
    pointer.y = pos.y;
    spawnAt(pos.x, pos.y);
  });

  canvas.addEventListener("pointermove", (e) => {
    if (!pointer.active) return;
    const pos = getCanvasPos(e);
    pointer.x = pos.x;
    pointer.y = pos.y;
  });

  canvas.addEventListener("pointerup", () => {
    pointer.active = false;
  });

  window.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
      engine.paused = !engine.paused;
      ui.pause.innerHTML = engine.paused ? "‚ñ∂Ô∏è Resume <small>Toggle simulation</small>" : "‚è∏Ô∏è Pause <small>Toggle simulation</small>";
    }
    if (e.key.toLowerCase() === "c") {
      particles.length = 0;
    }

    if (e.key === "1") setPreset("hit");
    if (e.key === "2") setPreset("heal");
    if (e.key === "3") setPreset("shimmer");
    if (e.key === "4") setPreset("smoke");
    if (e.key === "5") setPreset("confetti");
  });

  // ------------------------------------------------------------
  // UI wiring
  // ------------------------------------------------------------

  document.getElementById("presetHit").addEventListener("click", () => setPreset("hit"));
  document.getElementById("presetHeal").addEventListener("click", () => setPreset("heal"));
  document.getElementById("presetShimmer").addEventListener("click", () => setPreset("shimmer"));
  document.getElementById("presetSmoke").addEventListener("click", () => setPreset("smoke"));
  document.getElementById("presetConfetti").addEventListener("click", () => setPreset("confetti"));

  ui.clear.addEventListener("click", () => { particles.length = 0; });

  ui.pause.addEventListener("click", () => {
    engine.paused = !engine.paused;
    ui.pause.innerHTML = engine.paused ? "‚ñ∂Ô∏è Resume <small>Toggle simulation</small>" : "‚è∏Ô∏è Pause <small>Toggle simulation</small>";
  });

  // Default preset
  setPreset("hit");

  requestAnimationFrame(step);
</script>
</body>
</html>
